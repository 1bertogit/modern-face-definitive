---
/**
 * BlogCard.astro
 * Card de artigo premium com design editorial luxury
 * Inspirado em Apple, Stripe, Linear
 */

import { getBlogPostUrl } from '@lib/urlBuilders';
import { formatDateShort } from '@lib/dateFormatter';

export interface Props {
  slug: string;
  title: string;
  description: string;
  category: string;
  readTime: string;
  date: string;
  featured?: boolean;
  image?: string;
  locale?: 'pt' | 'en' | 'es';
  class?: string;
}

const {
  slug,
  title,
  description,
  category,
  readTime,
  date,
  featured = false,
  image,
  locale = 'en',
  class: className = '',
} = Astro.props;

const url = getBlogPostUrl(slug, locale);
const formattedDate = formatDateShort(date, locale);
---

<article
  class:list={[
    'group relative bg-white rounded-xl overflow-hidden',
    'border border-gray-100',
    'transition-all duration-300 ease-out',
    'hover:shadow-xl hover:shadow-primary-900/5',
    'hover:border-accent-500/50',
    'hover:-translate-y-1',
    featured && 'md:flex md:gap-8',
    className,
  ]}
>
  <!-- Thumbnail Container -->
  <a
    href={url}
    class:list={['block overflow-hidden', featured ? 'md:w-1/2 md:flex-shrink-0' : '']}
    aria-label={`Ler artigo: ${title}`}
  >
    <div
      class:list={['relative w-full overflow-hidden', featured ? 'aspect-[16/10]' : 'aspect-video']}
    >
      {
        image ? (
          <picture>
            <source srcset={image.replace(/\.png$/, '.webp')} type="image/webp" />
            <img
              src={image}
              alt={title}
              loading="lazy"
              decoding="async"
              class="w-full h-full object-cover transition-transform duration-500 ease-out group-hover:scale-105"
            />
          </picture>
        ) : (
          <div class="w-full h-full bg-gradient-to-br from-primary-800 via-primary-700 to-primary-600 flex items-center justify-center transition-transform duration-500 ease-out group-hover:scale-105">
            <span class="text-6xl text-white/10 font-serif select-none" aria-hidden="true">
              FM
            </span>
          </div>
        )
      }
    </div>
  </a>

  <!-- Content -->
  <div class:list={['p-5', featured && 'md:p-6 md:flex md:flex-col md:justify-center']}>
    <!-- Meta Row: Category + Read Time -->
    <div class="flex items-center gap-3 mb-3">
      <span class="label-eyebrow bg-accent-50 px-2.5 py-1 rounded-full">
        {category}
      </span>
      <span class="label-caption flex items-center gap-1">
        <span class="material-symbols-outlined text-sm" aria-hidden="true">schedule</span>
        {readTime}
      </span>
    </div>

    <!-- Title -->
    <h3
      class:list={[
        'font-serif leading-snug text-primary-900',
        'transition-colors duration-300',
        'group-hover:text-accent-600',
        featured ? 'heading-3 mb-4' : 'heading-4 mb-2',
      ]}
    >
      <a href={url} class="block line-clamp-2">
        {title}
      </a>
    </h3>

    <!-- Excerpt -->
    <p
      class:list={[
        'text-warmGray leading-relaxed',
        featured ? 'body-base line-clamp-3 mb-4' : 'body-small line-clamp-2 mb-3',
      ]}
    >
      {description}
    </p>

    <!-- Footer: Date -->
    <time datetime={date} class="label-caption uppercase tracking-wide block">
      {formattedDate}
    </time>
  </div>
</article>

<style>
  /* Garantir line-clamp funciona */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
