---
/**
 * BlogSidebar.astro
 * Sidebar premium com busca, categorias, posts populares e CTA
 * Design clean inspirado em Stripe/Linear
 */

import BlogSearch from '@components/islands/BlogSearch';

export interface Category {
  name: string;
  slug: string;
  count: number;
}

export interface PopularPost {
  slug: string;
  title: string;
  readTime: string;
  category: string;
}

export interface Article {
  slug: string;
  title: string;
  description: string;
  category: string;
  readTime: string;
}

export interface Props {
  categories: Category[];
  popularPosts: PopularPost[];
  articles: Article[]; // Para busca
  currentCategory?: string;
  locale?: 'pt' | 'en' | 'es';
  class?: string;
}

const {
  categories,
  popularPosts,
  articles,
  currentCategory,
  locale = 'en',
  class: className = '',
} = Astro.props;

// Traduções
const t = {
  pt: {
    search: 'Buscar',
    categories: 'Categorias',
    popular: 'Mais Lidos',
    cta: {
      title: 'Aprenda com Dr. Robério',
      description: 'Mentoria especializada em cirurgia facial com mais de 1.500 casos.',
      button: 'Conhecer Mentoria',
      link: '/pt/educacao',
    },
  },
  en: {
    search: 'Search',
    categories: 'Categories',
    popular: 'Most Read',
    cta: {
      title: 'Learn with Dr. Robério',
      description: 'Specialized mentorship in facial surgery with over 1,500 cases.',
      button: 'Explore Mentorship',
      link: '/education',
    },
  },
  es: {
    search: 'Buscar',
    categories: 'Categorías',
    popular: 'Más Leídos',
    cta: {
      title: 'Aprende con Dr. Robério',
      description: 'Mentoría especializada en cirugía facial con más de 1.500 casos.',
      button: 'Conocer Mentoría',
      link: '/es/educacion',
    },
  },
};

const trans = t[locale] || t.en;

const getUrl = (slug: string) => {
  if (locale === 'en') return `/blog/${slug}`;
  if (locale === 'pt') return `/pt/blog/${slug}`;
  return `/${locale}/blog/${slug}`;
};

const getCategoryUrl = (categorySlug: string) => {
  const baseUrl = locale === 'en' ? '/blog' : locale === 'pt' ? '/pt/blog' : `/${locale}/blog`;
  return `${baseUrl}?categoria=${categorySlug}`;
};
---

<aside class:list={['space-y-6 lg:sticky lg:top-28', className]} aria-label="Sidebar do blog">
  <!-- Search Section -->
  <div class="bg-white rounded-xl p-5 border border-gray-100">
    <h3 class="label-eyebrow mb-4">
      {trans.search}
    </h3>
    <BlogSearch articles={articles} locale={locale} client:load />
  </div>

  <!-- Categories Section -->
  <div class="bg-white rounded-xl p-5 border border-gray-100">
    <h3 class="label-eyebrow mb-4">
      {trans.categories}
    </h3>
    <ul class="space-y-1" role="list">
      {
        categories.map((category) => (
          <li>
            <a
              href={getCategoryUrl(category.slug)}
              class:list={[
                'flex items-center justify-between px-3 py-2.5 rounded-lg',
                'body-small transition-all duration-300',
                currentCategory === category.slug
                  ? 'bg-accent-50 text-accent-700 font-medium border-l-2 border-accent-500 -ml-px'
                  : 'text-warmGray hover:bg-ivory hover:text-primary-900',
              ]}
            >
              <span>{category.name}</span>
              <span
                class:list={[
                  'text-[10px] px-2 py-0.5 rounded-full font-medium',
                  currentCategory === category.slug
                    ? 'bg-accent-100 text-accent-700'
                    : 'bg-primary-100 text-primary-600',
                ]}
              >
                {category.count}
              </span>
            </a>
          </li>
        ))
      }
    </ul>
  </div>

  <!-- Popular Posts Section -->
  {
    popularPosts.length > 0 && (
      <div class="bg-white rounded-xl p-5 border border-gray-100">
        <h3 class="label-eyebrow mb-4">{trans.popular}</h3>
        <ul class="space-y-4" role="list">
          {popularPosts.slice(0, 5).map((post, index) => (
            <li>
              <a href={getUrl(post.slug)} class="flex gap-4 group">
                <span
                  class="text-2xl font-serif text-primary-200 group-hover:text-accent-600 transition-colors duration-300 leading-none"
                  aria-hidden="true"
                >
                  {String(index + 1).padStart(2, '0')}
                </span>
                <div class="flex-1 min-w-0">
                  <span class="block body-small text-primary-900 font-medium leading-snug line-clamp-2 group-hover:text-accent-600 transition-colors duration-300">
                    {post.title}
                  </span>
                  <span class="block label-caption mt-1">
                    {post.category} · {post.readTime}
                  </span>
                </div>
              </a>
            </li>
          ))}
        </ul>
      </div>
    )
  }

  <!-- CTA Section -->
  <div class="bg-primary-900 rounded-xl p-6 text-white">
    <h3 class="heading-3-white mb-2">
      {trans.cta.title}
    </h3>
    <p class="body-small-light mb-5">
      {trans.cta.description}
    </p>
    <a
      href={trans.cta.link}
      class="inline-flex items-center justify-center w-full px-5 py-3
             bg-accent-600 text-white rounded-lg
             text-sm font-medium uppercase tracking-wider
             hover:bg-accent-500 transition-colors duration-300
             focus:outline-none focus:ring-2 focus:ring-accent-400 focus:ring-offset-2 focus:ring-offset-primary-900"
    >
      {trans.cta.button}
      <span class="material-symbols-outlined text-lg ml-2" aria-hidden="true">arrow_forward</span>
    </a>
  </div>
</aside>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
