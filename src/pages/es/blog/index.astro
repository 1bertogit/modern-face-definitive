---
/**
 * Blog Index Page (Spanish) - Premium UI
 * Uses Content Collections for blog data
 */
import BaseLayout from '@layouts/BaseLayout.astro';
import Breadcrumb from '@components/ui/Breadcrumb.astro';
import BlogGrid from '@components/blog/BlogGrid.astro';
import BlogSidebar from '@components/blog/BlogSidebar.astro';
import { getArticlesForLocale, getCategories, getPopularArticles } from '@lib/blog-utils';

const locale = 'es';

const breadcrumbs = [
  { name: 'Inicio', url: '/es' },
  { name: 'Blog', url: '/es/blog' },
];

// Ler parâmetro de categoria da URL
const selectedCategory = Astro.url.searchParams.get('categoria') || null;

// Use Content Collections for blog data
const allArticles = await getArticlesForLocale(locale);

// Filtrar artigos por categoria se houver parâmetro
const articles = selectedCategory
  ? allArticles.filter((article) => {
      // Converter categoria do artigo para slug para comparação
      const articleCategorySlug = article.category.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');
      return articleCategorySlug === selectedCategory.toLowerCase();
    })
  : allArticles;

const categories = await getCategories(locale);
const popularPosts = await getPopularArticles(locale, 5);

// Prepare search articles
const searchArticles = articles.map((a) => ({
  slug: a.slug,
  title: a.title,
  description: a.description,
  category: a.category,
  readTime: a.readTime,
}));
---

<BaseLayout
  title="Blog | Modern Face Institute | Dr. Robério Brandão"
  description="Artículos técnicos sobre cirugía facial, técnicas Modern Face, Endomidface, anatomía aplicada y educación médica continua. Contenido para cirujanos plásticos."
  keywords={[
    'blog cirugía facial',
    'artículos Modern Face',
    'artículos Endomidface',
    'blog Dr Robério Brandão',
  ]}
  lang="es"
>
  <!-- Hero Section - Editorial Luxury -->
  <section class="section-xl bg-neutral-greySoft border-b border-primary-900/5">
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
      <Breadcrumb items={breadcrumbs} class="mb-8" />

      <div class="max-w-2xl">
        <h1 class="heading-1 mb-6">Blog</h1>
        <p class="body-large text-neutral-graphite leading-relaxed">
          Artículos técnicos sobre cirugía facial, filosofía Modern Face, técnicas avanzadas y
          educación médica continua.
        </p>
      </div>
    </div>
  </section>

  <!-- Main Content: Grid + Sidebar -->
  <section class="py-12 md:py-16 bg-ivory">
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
      <div class="flex flex-col lg:flex-row gap-8 lg:gap-12">
        <!-- Main Content -->
        <main class="flex-1 min-w-0">
          <BlogGrid articles={articles} showFeatured={true} locale="es" />
        </main>

        <!-- Sidebar -->
        <aside class="w-full lg:w-80 flex-shrink-0">
          <BlogSidebar
            categories={categories}
            popularPosts={popularPosts}
            articles={searchArticles}
            currentCategory={selectedCategory || undefined}
            locale="es"
          />
        </aside>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-16 bg-primary-900">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 text-center">
      <h2 class="heading-2-white mb-4">Aprende Directamente con Dr. Robério</h2>
      <p class="body-large-light mb-8 max-w-xl mx-auto">
        Los artículos son solo el comienzo. La mentoría ofrece aprendizaje completo con casos en
        vivo y seguimiento personalizado.
      </p>
      <a
        href="/es/education"
        class="inline-flex items-center gap-2 px-8 py-4
               bg-accent-600 text-white rounded-lg
               text-sm font-medium uppercase tracking-wider
               hover:bg-accent-500 hover:-translate-y-0.5
               transition-all duration-300
               focus:outline-none focus:ring-2 focus:ring-accent-400 focus:ring-offset-2 focus:ring-offset-primary-900"
      >
        Ver Programas de Mentoría
        <span class="material-symbols-outlined" aria-hidden="true">arrow_forward</span>
      </a>
    </div>
  </section>
</BaseLayout>
